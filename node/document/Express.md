# Express

## Express框架是什么？

Express是一个基于Node平台的web应用的web开发框架，它提供了一系列的强大特性，帮助你创建各种web应用。

## Express框架特性

+ 提供了方便简洁的路由定义方式
+ 对获取http请求参数进行了简化处理
+ 对模板引擎支持度高，方便渲染动态HTML页面
+ 提供了中间件机制有效控制HTTP请求
+ 拥有大量第三方中间件对功能进行扩展

## Express框架简介及初体验

![1581238318402](C:\Users\刘如刚\AppData\Roaming\Typora\typora-user-images\1581238318402.png)

send()方法：

+ send方法内部会检测响应内容的类型
+ send()方法会自动设置http状态码
+ send()方法会帮我们自动设置响应的内容类型及编码



## 中间件

中间件就是一堆方法，可以接收客户端发来的请求，可以对请求作出响应，也可以将请求继续交给下一个中间件继续处理。

![1581305926635](C:\Users\刘如刚\AppData\Roaming\Typora\typora-user-images\1581305926635.png)

## 什么是中间件

中间件主要由两部分构成，中间件方法以及请求处理函数

中间件方法由Express提供，负责拦截请求，请求处理函数由开发人员提供，负责处理请求

```javascript
app.get('请求路径','处理函数') //接收并处理get请求
app.post('请求路径','处理函数') //接收并处理post请求
```

可以针对同一个请求设置多个中间件，对同一个请求进行多次处理

默认情况下，请求从上到下依次匹配中间件，一旦匹配成功，终止匹配.

可以调用next方案将请求的控制权交给下一个中间件，知道遇到结束请求的中间件。

```javascript
app.get('/request',(req,res,next)=>{
    req.name ="张三";
})
app.get('/request',(req,res)=>{
    res.send(req.name);
})
```

## app.use中间件用法

app.use 匹配所有的请求方式，可以直接传入请求处理函数，代表接收所有的请求。

```javascript
app.use((req,res,next)=>{
    console.log(req.url);
    next();
})
```

app.use 第一个参数也可以请求地址，代表无论什么请求方式，只要是这个请求地址就可以接收这个请求。

```javascript
app.use('/admin',(req,res,next)=>{
    consol.log(req.url);
    next();
})
```

## 中间件应用

+ 路由保护，客户端在访问需要登录的页面时，可以先使用中间件判断用户登录状态，用户如果为登录，则拦截请求响应，禁止用户进入需要登录的页面
+ 网站维护公告，在所有路由的最上面定义接收所有请求的中间件，直接为客户端做出响应，网站正在维护中。
+ 自定义404页面

## 错误处理中间件

在程序执行的过程中，不可避免的会出现一些无法预料的错误，比如文件读取失败，数据库连接失败，错误处理中间件是一个集中处理错误的地方。

